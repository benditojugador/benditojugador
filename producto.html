<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Detalle del producto | Bendito Jugador</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- CSS -->
  <link rel="stylesheet" href="css/styles.css" />

  <!-- Icons -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
  />
</head>

<body>

  <!-- ================= HEADER ================= -->
  <header class="main-header">
    <div class="container header-content">

      <div class="logo">
        <a href="index.html">
          <img src="assets/logo.png" alt="Bendito Jugador" />
        </a>
      </div>

      <nav class="main-nav">
        <a href="index.html">
          <i class="fas fa-home"></i> Inicio
        </a>
        <a href="index.html#productos" class="active">
          <i class="fas fa-shirt"></i> Productos
        </a>
      </nav>

    </div>
  </header>

  <!-- ================= DETALLE ================= -->
  <main class="container" style="padding: 32px 0">

    <div id="productDetail" class="product-detail">
      <!-- JS renderiza acá -->
    </div>

  </main>

  <!-- ================= FOOTER ================= -->
  <footer class="main-footer">
    <div class="container footer-content">
      <div>
        <strong>Bendito Jugador</strong>
        <p>Catálogo deportivo · Ventas mayoristas</p>
      </div>
    </div>
  </footer>

  <!-- ================= SCRIPT ================= -->
  <script type="module">
    import { supabase } from './js/auth.js'

    const PLACEHOLDER_IMG = 'assets/placeholder.png'
    const container = document.getElementById('productDetail')

    function safe(text) {
      return String(text ?? '')
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
    }

    function getParam(name) {
      return new URLSearchParams(window.location.search).get(name)
    }

    function buildTitle(p) {
      const parts = []
      if (p.tipo_ropa) parts.push(p.tipo_ropa)
      if (p.equipo) parts.push(p.equipo)
      if (p.año) parts.push(p.año)
      return parts.join(' ') || 'Producto'
    }

    function collectImages(p) {
      const imgs = [
        p.portada,
        p.img1,
        p.img2,
        p.img3,
        p.img4,
        p.img5
      ].filter(Boolean)

      return imgs.length ? imgs : [PLACEHOLDER_IMG]
    }

    async function loadProduct() {
      const id = getParam('id')

      if (!id) {
        container.innerHTML = '<p>Producto no encontrado.</p>'
        return
      }

      const { data, error } = await supabase
        .from('productos_deportivos')
        .select('*')
        .eq('id', id)
        .single()

      if (error || !data) {
        container.innerHTML = '<p>No se pudo cargar el producto.</p>'
        return
      }

      const title = buildTitle(data)
      const images = collectImages(data)

      const whatsappMsg = encodeURIComponent(
        `Hola, vengo a consultar por el producto: ${title}`
      )

      container.innerHTML = `
        <div class="detail-grid">

          <!-- Galería -->
          <div class="detail-images">
            ${images.map(src => `
              <img
                src="${safe(src)}"
                alt="${safe(title)}"
                onerror="this.onerror=null;this.src='${PLACEHOLDER_IMG}'"
              >
            `).join('')}
          </div>

          <!-- Info -->
          <div class="detail-info">
            <h1>${safe(title)}</h1>

            <ul class="detail-list">
              ${data.deporte ? `<li><strong>Deporte:</strong> ${safe(data.deporte)}</li>` : ''}
              ${data.nacionalidad ? `<li><strong>Nacionalidad:</strong> ${safe(data.nacionalidad)}</li>` : ''}
              ${data.tipo_equipo ? `<li><strong>Tipo de equipo:</strong> ${safe(data.tipo_equipo)}</li>` : ''}
              ${data.etiquetas ? `<li><strong>Etiquetas:</strong> ${safe(data.etiquetas)}</li>` : ''}
            </ul>

            ${data.descripcion ? `<p>${safe(data.descripcion)}</p>` : ''}

            <a
              class="btn-primary"
              href="https://wa.me/5492645454982?text=${whatsappMsg}"
              target="_blank"
            >
              <i class="fab fa-whatsapp"></i>
              Consultar por WhatsApp
            </a>
          </div>

        </div>
      `
    }

    loadProduct()
  </script>

</body>
</html>
